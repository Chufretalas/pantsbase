{{define "index"}}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/static/js/index.js" defer></script>
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/global.css">
    <link rel="stylesheet" href="/static/css/index.css">
    <title>Pantsbase ðŸ‘–</title>
</head>

<body>
    <nav>
        <h1>Welcome to Pantsbase</h1>
    </nav>

    <main>

        <section class="your_tables_wrapper">
            <h2 class="your_tables_title">Your Tables</h2>
            <ul class="your_tables_list">
                <li><a href="" class="your_tables_item">todos</a></li>
                <li><a href="" class="your_tables_item">completed</a></li>
                <li><a href="" class="your_tables_item">deleted</a></li>
            </ul>
        </section>

        <hr>

        <iframe name="dummyframe" id="dummyframe" style="display: none;"></iframe>
        <h2>New Table</h2>
        <form action="new_table" method="POST" target="dummyframe" id="nt_form">
            <div class="nt_name_input_wrapper">
                <label for="new_table_name_input">Table Name</label>
                <input type="text" name="name" id="new_table_name_input" placeholder="name your new table" required>
            </div>
            <span>* Note that a "id INTEGER PRIMARY KEY AUTOINCREMENT" is automatically created for every table</span>
            <ol class="nt_columns">
                <!-- Here the column inputs will be dynamically created -->
            </ol>
            <button id="nt_new_column_button">+<span>new column</span></button>
            <input type="hidden" name="column_indexes" id="column_indexes_input">
            <button type="submit" id="new_table_button">Create</button>
        </form>

        <hr>
    </main>

    <script>
        const columnIndexes = []
        const columnIndexesInput = document.querySelector("#column_indexes_input")
        const form = document.querySelector("#nt_form")
        form.addEventListener("submit", (e => {
            console.log(e)
        }))
        const ntColumns = document.querySelector(".nt_columns")
        const ncButton = document.querySelector("#nt_new_column_button")
        ncButton.addEventListener("click", (e) => {
            e.preventDefault()
            const newIndex = columnIndexes.length === 0 ? 0 : columnIndexes[columnIndexes.length - 1] + 1
            columnIndexes.push(newIndex)
            columnIndexesInput.value = columnIndexes.map((number) => `${number}`).join(" ")
            const newColumnElement = document.createElement("li")
            newColumnElement.className = "nt_column"
            newColumnElement.innerHTML = `
                    <span>Column: </span>
                    <div class="nt_column_name">
                        <label for="n${newIndex}" class="nt_column_name_label">Name:</label>
                        <input type="text" name="n${newIndex}" id="n${newIndex}" required>
                    </div>
                    <div class="nt_column_type">
                        <label for="t${newIndex}" class="nt_column_type_label">Type:</label>
                        <select name="t${newIndex}" id="t${newIndex}" class="nt_column_type_input">
                            <option value="INTEGER">INTEGER</option>
                            <option value="REAL">REAL</option>
                            <option value="TEXT">TEXT</option>
                        </select>
                    </div>
                    <button class="remove_new_column" id="remove_new_column_${newIndex}" value=${newIndex} type="button">X</button>
            `
            ntColumns.appendChild(newColumnElement)
            document.querySelector(`#remove_new_column_${newIndex}`).addEventListener("click", removeNewColumn)

        })
        function removeNewColumn(e) {
            e.preventDefault()
            console.log(e.target.value)
            for (let child of ntColumns.children) {
                if (child.innerHTML.includes(`t${e.target.value}`)) {
                    ntColumns.removeChild(child)
                    columnIndexes.splice(columnIndexes.indexOf(e.target.value) - 1, 1)
                    columnIndexesInput.value = columnIndexes.map((number) => `${number}`).join(" ")
                    return
                }
            }
        }
    </script>
</body>

</html>
{{end}}